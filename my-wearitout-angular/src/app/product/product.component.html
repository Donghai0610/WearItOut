<app-header></app-header>
<div class="product-container">
  <!-- Search Filters -->
  <div class="search-section">
    <div class="search-header">
      <h2>ğŸ›ï¸ KhÃ¡m phÃ¡ sáº£n pháº©m</h2>
      <p>TÃ¬m kiáº¿m vÃ  lá»c sáº£n pháº©m theo Ã½ muá»‘n</p>
    </div>
    
    <div class="search-form">
      <div class="search-row">
        <div class="search-field">
          <label>ğŸ” TÃªn sáº£n pháº©m</label>
          <input 
            type="text" 
            [(ngModel)]="searchForm.productName"
            placeholder="Nháº­p tÃªn sáº£n pháº©m..."
            class="search-input"
          >
        </div>
        
        <div class="search-field">
          <label>ğŸª Cá»­a hÃ ng</label>
          <input 
            type="text" 
            [(ngModel)]="searchForm.shop"
            placeholder="TÃªn cá»­a hÃ ng..."
            class="search-input"
          >
        </div>
        
        <div class="search-field">
          <label>ğŸ“‚ Danh má»¥c</label>
          <select [(ngModel)]="searchForm.setting" class="search-select">
            <option value="">Táº¥t cáº£ danh má»¥c</option>
            <option value="Ão Thun">Ão Thun</option>
            <option value="Quáº§n Jeans">Quáº§n Jeans</option>
            <option value="Ão KhoÃ¡c">Ão KhoÃ¡c</option>
            <option value="VÃ¡y">VÃ¡y</option>
          </select>
        </div>
      </div>
      
      <div class="search-row">
        <div class="search-field">
          <label>ğŸ’° GiÃ¡ tá»«</label>
          <input 
            type="number" 
            [(ngModel)]="searchForm.priceMin"
            placeholder="0"
            class="search-input"
            min="0"
          >
        </div>
        
        <div class="search-field">
          <label>ğŸ’° GiÃ¡ Ä‘áº¿n</label>
          <input 
            type="number" 
            [(ngModel)]="searchForm.priceMax"
            placeholder="1000000"
            class="search-input"
            min="0"
          >
        </div>
        
        <div class="search-field">
          <label>â­ Rating tá»«</label>
          <select [(ngModel)]="searchForm.ratingMin" class="search-select">
            <option value="">Táº¥t cáº£</option>
            <option value="1">1 sao</option>
            <option value="2">2 sao</option>
            <option value="3">3 sao</option>
            <option value="4">4 sao</option>
            <option value="5">5 sao</option>
          </select>
        </div>
        
        <div class="search-field">
          <label>ğŸ“Š Sáº¯p xáº¿p</label>
          <select [(ngModel)]="searchForm.sortDirection" class="search-select">
            <option value="asc">GiÃ¡ tÄƒng dáº§n</option>
            <option value="desc">GiÃ¡ giáº£m dáº§n</option>
          </select>
        </div>
      </div>
      
      <div class="search-actions">
        <button (click)="onSearch()" class="btn-search" [disabled]="isLoading">
          <span *ngIf="!isLoading">ğŸ” TÃ¬m kiáº¿m</span>
          <span *ngIf="isLoading">â³ Äang tÃ¬m...</span>
        </button>
        <button (click)="clearFilters()" class="btn-clear" [disabled]="isLoading">
          ğŸ—‘ï¸ XÃ³a bá»™ lá»c
        </button>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Äang táº£i sáº£n pháº©m...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !isLoading" class="error-container">
    <div class="error-icon">âŒ</div>
    <p>{{ error }}</p>
    <button (click)="loadProducts()" class="btn-retry">ğŸ”„ Thá»­ láº¡i</button>
  </div>

  <!-- Products Grid -->
  <div *ngIf="!isLoading && !error" class="products-section">
    <div class="products-header">
      <h3>ğŸ“¦ {{ totalElements }} sáº£n pháº©m Ä‘Æ°á»£c tÃ¬m tháº¥y</h3>
      <div class="results-info">
        Trang {{ currentPage + 1 }} / {{ totalPages }}
      </div>
    </div>

    <div class="products-grid" *ngIf="products.length > 0">
      <div *ngFor="let product of products; trackBy: trackByProductId" class="product-card">
        <div class="product-image-container">
          <img 
            [src]="product.image" 
            [alt]="product.name"
            class="product-image"
            loading="lazy"
            onerror="this.src='https://via.placeholder.com/300x400?text=No+Image'"
          >
          <div class="product-status" [class]="product.status?.toLowerCase()">
            {{ product.status }}
          </div>
        </div>
        
        <div class="product-info">
          <h4 class="product-name" [title]="product.name">{{ product.name }}</h4>
          
          <div class="product-details">
            <div class="product-category">ğŸ“‚ {{ product.category }}</div>
            <div class="product-shop">ğŸª {{ product.shop }}</div>
          </div>
          
          <div class="product-rating">
            <div class="stars">
              <span 
                *ngFor="let star of getStarArray(product.rating)" 
                class="star"
                [class.filled]="star === 1"
              >â­</span>
            </div>
            <span class="rating-text">({{ product.rating }}/5)</span>
          </div>
          
          <div class="product-price">
            <span class="current-price">{{ formatPrice(product.price) }}</span>
            <span *ngIf="product.originalPrice" class="original-price">
              {{ formatPrice(product.originalPrice) }}
            </span>
          </div>
          
          <div class="product-stock">
            <span class="stock-info" [class.out-of-stock]="product.stockQuantity === 0">
              ğŸ“¦ {{ product.stockQuantity === 0 ? 'Háº¿t hÃ ng' : 'CÃ²n ' + product.stockQuantity + ' sáº£n pháº©m' }}
            </span>
          </div>
          
          <div class="product-actions">
            <button 
              class="btn-view"
              [disabled]="product.stockQuantity === 0"
            >
              ğŸ‘ï¸ Xem chi tiáº¿t
            </button>
            <button 
              class="btn-cart"
              [disabled]="product.stockQuantity === 0 || isLoading"
              (click)="addToCart(product, 1)"
              [class.loading]="isLoading"
              [class.in-cart]="isProductInCart(product.id)"
            >
              <span *ngIf="!isProductInCart(product.id)">ğŸ›’ ThÃªm vÃ o giá»</span>
              <span *ngIf="isProductInCart(product.id)">âœ… ÄÃ£ thÃªm ({{ getCartItemQuantity(product.id) }})</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="products.length === 0" class="empty-container">
      <div class="empty-icon">ğŸ“­</div>
      <h3>KhÃ´ng tÃ¬m tháº¥y sáº£n pháº©m nÃ o</h3>
      <p>Thá»­ thay Ä‘á»•i bá»™ lá»c tÃ¬m kiáº¿m hoáº·c tá»« khÃ³a khÃ¡c</p>
      <button (click)="clearFilters()" class="btn-clear-all">ğŸ—‘ï¸ XÃ³a táº¥t cáº£ bá»™ lá»c</button>
    </div>

    <!-- Pagination -->
    <div *ngIf="products.length > 0 && totalPages > 1" class="pagination">
      <button 
        (click)="onPageChange(currentPage - 1)"
        [disabled]="currentPage === 0"
        class="btn-page"
      >
        Â« TrÆ°á»›c
      </button>
      
      <div class="page-numbers">
        <button 
          *ngFor="let page of [].constructor(totalPages); let i = index"
          (click)="onPageChange(i)"
          [class.active]="i === currentPage"
          class="btn-page-number"
        >
          {{ i + 1 }}
        </button>
      </div>
      
      <button 
        (click)="onPageChange(currentPage + 1)"
        [disabled]="currentPage === totalPages - 1"
        class="btn-page"
      >
        Tiáº¿p Â»
      </button>
    </div>
  </div>
</div>
<app-footer></app-footer>